<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Basics of the ggplot2 package | Data Analysis and Visualization using R</title>
<meta name="author" content="Michiel Noback">
<meta name="description" content="In this chapter, we’ll explore the basics of the ggplot2 package. This package is one of the most popular packages of R, and the de facto standard for creating publishable visualizations. A later...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Chapter 5 Basics of the ggplot2 package | Data Analysis and Visualization using R">
<meta property="og:type" content="book">
<meta property="og:description" content="In this chapter, we’ll explore the basics of the ggplot2 package. This package is one of the most popular packages of R, and the de facto standard for creating publishable visualizations. A later...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Basics of the ggplot2 package | Data Analysis and Visualization using R">
<meta name="twitter:description" content="In this chapter, we’ll explore the basics of the ggplot2 package. This package is one of the most popular packages of R, and the de facto standard for creating publishable visualizations. A later...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.27/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/plotly-binding-4.10.4/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Analysis and Visualization using R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Getting started</a></li>
<li><a class="" href="toolbox.html"><span class="header-section-number">2</span> The toolbox</a></li>
<li><a class="" href="basic-r.html"><span class="header-section-number">3</span> Basic R</a></li>
<li><a class="" href="complex-datatypes-and-file-reading.html"><span class="header-section-number">4</span> Complex Datatypes and File Reading</a></li>
<li><a class="active" href="ggplot2.html"><span class="header-section-number">5</span> Basics of the ggplot2 package</a></li>
<li><a class="" href="built-in-functions.html"><span class="header-section-number">6</span> Built-in Functions</a></li>
<li><a class="" href="flow-control-and-scripting.html"><span class="header-section-number">7</span> Flow control and scripting</a></li>
<li><a class="" href="tidyr.html"><span class="header-section-number">8</span> Tidying dataframes using Package tidyr</a></li>
<li><a class="" href="mangling.html"><span class="header-section-number">9</span> Old school data mangling</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">10</span> Data mangling with dplyr</a></li>
<li><a class="" href="regex.html"><span class="header-section-number">11</span> Text processing with regex</a></li>
<li><a class="" href="ggplot2-adv.html"><span class="header-section-number">12</span> Package ggplot2 revisited</a></li>
<li><a class="" href="date-time.html"><span class="header-section-number">13</span> Working with date-time data</a></li>
<li><a class="" href="eda-1.html"><span class="header-section-number">14</span> Exploratory Data Analysis I</a></li>
<li><a class="" href="eda-2.html"><span class="header-section-number">15</span> Exploratory Data Analysis II</a></li>
<li><a class="" href="adding-interactivity.html"><span class="header-section-number">16</span> Adding interactivity</a></li>
<li><a class="" href="exercises.html"><span class="header-section-number">17</span> Exercises</a></li>
<li><a class="" href="exercise-solutions.html"><span class="header-section-number">18</span> Exercise solutions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot2" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Basics of the <code>ggplot2</code> package<a class="anchor" aria-label="anchor" href="#ggplot2"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter, we’ll explore the basics of the <code>ggplot2</code> package. This package is one of the most popular packages of R, and the de facto standard for creating publishable visualizations. A later chapter will present more details of it possibilities.</p>
<p>Whole books have been written about ggplot2 (e.g. <a href="https://ggplot2-book.org/">ggplot2 - Elegant Statistics for Data Aanalysis</a>); these will not be repeated here. Instead, I have selected the minimal amount of information and examples to get you going in your own visualization endeavours in biomedical research. For that reason, this chapter only deals with the base <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function and its most important usage scenarios.<br>
In my opinion, you are best prepared when first learning the ggplot “language” structure, not the complete listing of possibilities. You can check these out later on your own. If you are interested in what the package has to offer, type <code><a href="https://ggplot2.tidyverse.org/reference">help(package="ggplot2")</a></code> on the console.</p>
<div id="getting-started-1" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Getting started<a class="anchor" aria-label="anchor" href="#getting-started-1"><i class="fas fa-link"></i></a>
</h2>
<div id="keep-the-goal-in-mind" class="section level3 unnumbered">
<h3>Keep the goal in mind<a class="anchor" aria-label="anchor" href="#keep-the-goal-in-mind"><i class="fas fa-link"></i></a>
</h3>
<p>You should always remember the purpose with which you create a plot:</p>
<ol style="list-style-type: decimal">
<li>
<strong><em>Communicate results in a visual way</em></strong>. The <em>audience</em> consists of other professionals: fellow scientists, students, project managers, CEO’s. The <em>scope</em> is in reports, publications, presentations etc. Your plots should be immaculately annotated - have a title and/or caption, axis labels with physical quantities (e.g. Temperature) and measurement units (e.g. Celsius), and a legend (if relevant).</li>
<li>
<strong><em>Create a representation of data for visual inspection</em></strong>. The <em>audience</em> is yourself. This is especially important in Exploratory Data Analysis (EDA). You visualize your data in order to discover patterns, trends, outliers and to generate new questions and hypotheses. The biggest challenge is to select the correct, most appropriate visualization that keeps you moving on your research track.</li>
</ol>
<p>Besides this, you should of course choose a relevant visualization for your data. For instance, generating a boxplot representing only a few data points is a poor choice, as will a scatterplot for millions of data points almost always be.</p>
<p>To help your imagination and see what is possible you should really browse through <a href="https://www.r-graph-gallery.com/">The R Graph Gallery</a>. It has code for all the charts in the gallery.</p>
</div>
<div id="a-first-plot" class="section level3 unnumbered">
<h3>A first plot<a class="anchor" aria-label="anchor" href="#a-first-plot"><i class="fas fa-link"></i></a>
</h3>
<p>Install the packages <code>ggplot2</code> first, if not already installed.</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span></code></pre></div>
<p>After installing, you’ll need to load the packages.</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Let’s dive right in and create a first plot, and walk through the different parts of this code.</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airquality</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">Ozone</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Removed 37 rows containing missing values (`geom_point()`).</code></pre>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:first-plot"></span>
<img src="DAVuR_files/figure-html/first-plot-1.png" alt="A scatter plot visualizing Ozone as a function of Temperature" width="80%"><p class="caption">
Figure 5.1: A scatter plot visualizing Ozone as a function of Temperature
</p>
</div>
<p>There are two <strong><em>chained function calls</em></strong>: <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>. They are chained using the <code>+</code> operator. The first function, <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, creates the base layer of the plot. It receives the data and defines how it maps to the two axes. By itself, <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, will not display anything of your data. It creates an empty plot where the axes are defined and have the correct scale:</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airquality</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">Ozone</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:empty-plot"></span>
<img src="DAVuR_files/figure-html/empty-plot-1.png" alt="An empty plot pane" width="80%"><p class="caption">
Figure 5.2: An empty plot pane
</p>
</div>
<p>The next function, <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>, builds on the base layer it receives via the <code>+</code> operator and adds a new layer to the plot, a data representation using points.</p>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> function encounters rows with missing data and issues a warning (<code>Warning: Removed 37 rows...</code>) but proceeds anyway. There are two ways to prevent this annoying warning message. The first is to put a <code>warning=FALSE</code> statement in the RMarkdown chunk header. This is usually <strong>not</strong> a good idea because you should be explicit about problem handling when implementing a data analysis workflow because it hinders the reproducibility of your work. Therefore, removing the missing values explicitly is a better solution:</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">airqual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="co">#convert to use month labels instead of numbers</span></span>
<span><span class="va">airqual</span><span class="op">$</span><span class="va">Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">month.abb</span><span class="op">[</span><span class="va">airqual</span><span class="op">$</span><span class="va">Month</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">Ozone</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To obtain a similar plot as created above with “base” R, you would have done something like this:</p>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">airqual</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">Ozone</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:first-plot-baseR"></span>
<img src="DAVuR_files/figure-html/first-plot-baseR-1.png" alt="The same visualization with base R" width="80%"><p class="caption">
Figure 5.3: The same visualization with base R
</p>
</div>
<p>You can immediately see why ggplot2 has become so popular. When creating more complex plots it becomes more obvious still, as shown below.</p>
</div>
<div id="adding-a-dimension-using-color" class="section level3 unnumbered">
<h3>Adding a dimension using color<a class="anchor" aria-label="anchor" href="#adding-a-dimension-using-color"><i class="fas fa-link"></i></a>
</h3>
<p>This plot shows the power of ggplot2: building complex visualizations with minimal code.</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">Ozone</span>, color <span class="op">=</span> <span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:first-plot-w-color1"></span>
<img src="DAVuR_files/figure-html/first-plot-w-color1-1.png" alt="Ozone as function of Temp with plot symbols colored by Month" width="80%"><p class="caption">
Figure 5.4: Ozone as function of Temp with plot symbols colored by Month
</p>
</div>
</div>
<div id="inspecting-and-tuning-the-figure" class="section level3 unnumbered">
<h3>Inspecting and tuning the figure<a class="anchor" aria-label="anchor" href="#inspecting-and-tuning-the-figure"><i class="fas fa-link"></i></a>
</h3>
<p>What can you tell about the data and its measurements when looking at this plot?</p>
<p>Looking at the above plot, you should notice that</p>
<ol style="list-style-type: lower-alpha">
<li>the temperature measurement is probably in degrees Fahrenheit. This should be apparent from the plot. The measurement unit for Ozone is missing. You should look both up; the <code>datasets</code> package doc says it is in Parts Per Billion (ppb).<br>
</li>
<li>temperature is lowest in the fifth month -probably May but once again you should make certain- and highest in months 8 and 9.</li>
<li>ozone levels seem positively correlated with temperature (or Month), but not in an obvious linear way</li>
<li>a detail: temperature is measured in whole degrees only. This will give plotting artifacts: discrete vertical lines of data points.</li>
</ol>
<p>The plot below fixes and addresses the above issues to create a publication-ready figure. We’ll get to the details of this code as we proceed in this chapter. For now the message is <strong><em>be meticulous in constructing your plot</em></strong>.</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">Ozone</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="co">#the default formula, but prevents a printed message</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Temperature "</span> <span class="op">(</span><span class="va">degree</span><span class="op">~</span><span class="cn">F</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Ozone (ppb)"</span><span class="op">)</span> </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:first-plot-w-color2"></span>
<img src="DAVuR_files/figure-html/first-plot-w-color2-1.png" alt='Ozone level dependency on Temperature. Grey area: Loess smoother with 95% confidence interval. Source: R dataset "Daily air quality measurements in New York, May to September 1973."' width="80%"><p class="caption">
Figure 5.5: Ozone level dependency on Temperature. Grey area: Loess smoother with 95% confidence interval. Source: R dataset “Daily air quality measurements in New York, May to September 1973.”
</p>
</div>
</div>
</div>
<div id="overview-of-ggplot" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Overview of ggplot<a class="anchor" aria-label="anchor" href="#overview-of-ggplot"><i class="fas fa-link"></i></a>
</h2>
<div id="ggplot2-and-the-theory-of-graphics" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> ggplot2 and the theory of graphics<a class="anchor" aria-label="anchor" href="#ggplot2-and-the-theory-of-graphics"><i class="fas fa-link"></i></a>
</h3>
<div id="philosophy-of-ggplot2" class="section level4 unnumbered">
<h4>Philosophy of ggplot2<a class="anchor" aria-label="anchor" href="#philosophy-of-ggplot2"><i class="fas fa-link"></i></a>
</h4>
<p>The author of ggplot2, Hadley Wickham, had a very clear goal in mind when he embarked on the development of this package:</p>
<p><em>“The emphasis in ggplot2 is reducing the amount of thinking time by making it easier to go from the plot in your brain to the plot on the page.” (Wickham, 2012)</em></p>
<p>The way this is achieved is through “<strong><em>The grammar of graphics</em></strong>”</p>
</div>
<div id="the-grammar-of-graphics" class="section level4 unnumbered">
<h4>The grammar of graphics<a class="anchor" aria-label="anchor" href="#the-grammar-of-graphics"><i class="fas fa-link"></i></a>
</h4>
<p>The grammar of graphics tells us that a statistical graphic is a mapping from data to geometric objects (points, lines, bars) with aesthetic attributes (color, shape, size).</p>
<p>The plot may also contain statistical transformations of the data and is drawn on a specific coordinate system. Faceting -grid layout- can be used to generate the same plot for different subsets of the dataset.
(Wickham, 2010)</p>
</div>
</div>
<div id="building-plots-with-ggplot2" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Building plots with ggplot2<a class="anchor" aria-label="anchor" href="#building-plots-with-ggplot2"><i class="fas fa-link"></i></a>
</h3>
<div id="the-layered-plot-architecture" class="section level4 unnumbered">
<h4>The layered plot architecture<a class="anchor" aria-label="anchor" href="#the-layered-plot-architecture"><i class="fas fa-link"></i></a>
</h4>
<p>A graph in ggplot2 is built using a few “layers”, or building blocks.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:ggplot2-building-blocks-1">Table 5.1: </span>The three core ggplot2 layers</caption>
<thead><tr class="header">
<th align="left">ggplot2</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">data=</td>
<td align="left">the data that you want to plot</td>
</tr>
<tr class="even">
<td align="left">aes()</td>
<td align="left">mappings of data to position (axes), colors, sizes</td>
</tr>
<tr class="odd">
<td align="left">geom_…..()</td>
<td align="left">shapes (geometries) that will represent the data</td>
</tr>
</tbody>
</table></div>
<p>First, there is the <strong><em>data</em></strong> layer - the input data that you want to visualize:</p>
<div class="float">
<img src="figures/data_layer_50p.png" alt="The data layer"><div class="figcaption">The data layer</div>
</div>
<p>Next, using the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function, the data is <strong><em>mapped</em></strong> to a coordinate system. This encompasses not only the xy-coordinates but also possible extra plot dimensions such as color and shape.</p>
<div class="float">
<img src="figures/data_aes_layers_50p.png" alt="The data and aesthetic layers"><div class="figcaption">The data and aesthetic layers</div>
</div>
<p>As a third step, the data is <strong><em>visually represented</em></strong> in some way, using a <strong><em>geometry</em></strong> (dealt with by one of the many <code>geom_....()</code> functions). Examples of geometries are <strong><em>point</em></strong> for scatterplots, <strong><em>boxplot</em></strong>, <strong><em>line</em></strong> etc.</p>
<div class="float">
<img src="figures/data_aes_geom_layers_50p.png" alt="The data, aesthetic and geometry layers"><div class="figcaption">The data, aesthetic and geometry layers</div>
</div>
<p>At a minimum, these three layers are used in every plot you create.</p>
<p>Besides these fundamental aspects there are other elements you may wish to add or modify: axis labels, legend, titles, etc. These constitute additional, optional layers:</p>
<div class="float">
<img src="figures/all_layers_50p.png" alt="All layers"><div class="figcaption">All layers</div>
</div>
<p>Except for Statistics and Coordinates, each of these layers will be discussed in detail in subsequent paragraphs.</p>
</div>
<div id="tidy-the-data" class="section level4 unnumbered">
<h4>“Tidy” the data<a class="anchor" aria-label="anchor" href="#tidy-the-data"><i class="fas fa-link"></i></a>
</h4>
<p>This is a very important aspect of plotting using ggplot2: getting the data in a way that ggplot2 can deal with it. Sometimes it may be a bit challenging to get the data in such a format: some form of data mangling is often required. How to get your data like this is the topic of a next chapter, but here you’ll already see a little preview.</p>
<p>The ggplot2 function expects its data to come in a <strong><em>tidy</em></strong> format. A dataset is considered <strong><em>tidy</em></strong> when it is formed according to these rules:</p>
<ol style="list-style-type: decimal">
<li>Each variable has its own column.</li>
<li>Each observation has its own row.</li>
<li>Each value has its own cell.</li>
</ol>
<p>Want to know more about tidy data? Read the paper by Hadley Wickham: <span class="citation">(<a href="#ref-tidy-data"><strong>tidy-data?</strong></a>)</span>.</p>
<p>Here is an example dataset that requires some mangling, or <strong><em>tidying</em></strong>, to adhere to these rules.</p>
<pre><code>##    patient sex dose10mg dose100mg
## 1      001   f       12        88
## 2      002   f       11        54
## 3      003   m       54        14
## 4      004   m       71        21
## 5      005   f       19        89
## 6      006   f       22        99
## 7      007   f       23        69
## 8      008   m       68        31
## 9      009   f       30        85
## 10     010   m       83        18
## 11     011   m       72        37
## 12     012   m       48        28
## 13     013   m       67        16
## 14     014   f       13        79
## 15     015   m       73        22
## 16     016   f       20        84
## 17     017   f       22        96
## 18     018   m       40        14
## 19     019   m       57        12
## 20     020   f       26        63
## 21     021   f       17        89
## 22     022   f       29        77
## 23     023   m       54        21
## 24     024   m       61        10
## 25     025   m       57        36
## 26     026   f       11        80</code></pre>
<p>This dataset is not tidy because there is an independent variable -the dose- that should have its own column; its value is now buried inside two column headers (<code>dose10mg</code> and <code>dose10mg</code>). Also, there is actually a single variable -the response- that is now split into two columns. Thus, a row now contains two observations.</p>
<p>Suppose you want to plot the response as a function of the dose. That is not quite possible right now in ggplot2. This is because you want to do something like</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dose_response</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"&lt;I want to get the dose levels here&gt;"</span>,</span>
<span>                     y <span class="op">=</span> <span class="st">"&lt;I want to get the response here&gt;"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The problem is you cannot <strong><em>specify the mapping in a straightforward manner</em></strong>.
Note that in base R you would probably do this:</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">dose_response</span><span class="op">$</span><span class="va">dose10mg</span>, <span class="va">dose_response</span><span class="op">$</span><span class="va">dose100mg</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-with-untidy-data"></span>
<img src="DAVuR_files/figure-html/plot-with-untidy-data-1.png" alt="Selecting untidy data" width="50%"><p class="caption">
Figure 5.6: Selecting untidy data
</p>
</div>
<p>So, we need to tidy this dataframe since the <code>dose_10_response</code> and <code>dose_100_response</code> columns actually describe the same variable (measurement) but with different <em>conditions</em>.
Luckily, there is a very nice package that makes this quite easy: <code>tidyr</code>.</p>
</div>
<div id="tidying-data-using-tidyrpivot_longer" class="section level4 unnumbered">
<h4>Tidying data using <code>tidyr::pivot_longer()</code><a class="anchor" aria-label="anchor" href="#tidying-data-using-tidyrpivot_longer"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## tidy</span></span>
<span><span class="va">dose_response_tidy</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dose_response</span>,</span>
<span>                                   cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dose10mg"</span>, <span class="st">"dose100mg"</span><span class="op">)</span>,</span>
<span>                                   names_pattern <span class="op">=</span> <span class="st">"dose(\\d+)mg"</span>,</span>
<span>                                   names_to <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>                                   values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">dose_response_tidy</span>, </span>
<span>              options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pageLength <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                             dom <span class="op">=</span> <span class="st">'tpli'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f8f4fc32cb4f53f5649b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f8f4fc32cb4f53f5649b">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52"],["001","001","002","002","003","003","004","004","005","005","006","006","007","007","008","008","009","009","010","010","011","011","012","012","013","013","014","014","015","015","016","016","017","017","018","018","019","019","020","020","021","021","022","022","023","023","024","024","025","025","026","026"],["f","f","f","f","m","m","m","m","f","f","f","f","f","f","m","m","f","f","m","m","m","m","m","m","m","m","f","f","m","m","f","f","f","f","m","m","m","m","f","f","f","f","f","f","m","m","m","m","m","m","f","f"],["10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100","10","100"],[12,88,11,54,54,14,71,21,19,89,22,99,23,69,68,31,30,85,83,18,72,37,48,28,67,16,13,79,73,22,20,84,22,96,40,14,57,12,26,63,17,89,29,77,54,21,61,10,57,36,11,80]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>patient<\/th>\n      <th>sex<\/th>\n      <th>dose<\/th>\n      <th>response<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"dom":"tpli","columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>The data is tidy now, and ready for use within ggplot2.</p>
<p>We’ll explore the <code>pivot_longer()</code> function in detail in a next chapter when discussing the <code>tidyr</code> package.</p>
<p>Now, creating the plot in ggplot2 is a breeze</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dr_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dose_response_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dose</span>, y <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dr_plot</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/plot-tidy-basic-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Would you proceed with this hypothetical drug?</p>
</div>
</div>
<div id="inheritance-of-aesthetics" class="section level3" number="5.2.3">
<h3>
<span class="header-section-number">5.2.3</span> Inheritance of aesthetics<a class="anchor" aria-label="anchor" href="#inheritance-of-aesthetics"><i class="fas fa-link"></i></a>
</h3>
<p>In the code that creates the figure above you see two calls to the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function: one in <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> and one in <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>. Look at the same code, but with the aesthetics combined into the main ggplot call.</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">Ozone</span>, color <span class="op">=</span> <span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="co">#the default formula, but prevents a printed message</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Temperature "</span> <span class="op">(</span><span class="va">degree</span><span class="op">~</span><span class="cn">F</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Ozone (ppb)"</span><span class="op">)</span> </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:first-plot-w-color3"></span>
<img src="DAVuR_files/figure-html/first-plot-w-color3-1.png" alt='Ozone level dependency on Temperature. Grey area: Loess smoother with 95% confidence interval. Source: R dataset "Daily air quality measurements in New York, May to September 1973."' width="80%"><p class="caption">
Figure 5.7: Ozone level dependency on Temperature. Grey area: Loess smoother with 95% confidence interval. Source: R dataset “Daily air quality measurements in New York, May to September 1973.”
</p>
</div>
<p>The difference is cause by inheritance of aesthetics!</p>
<p>Like the main <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function, every <code>geom_</code> function accepts its own <code>mapping = aes(...)</code>. The mapping is <em>inherited</em> from the ggplot() function so any <code>aes(...)</code> mapping defined in the main <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> call applies to all subsequent layers. However, you can specify your own “local” aesthetic mapping within a <code>geom_xxxx()</code>. Aesthetics defined within a <code>geom_</code> function are scoped to that function call only.</p>
<p>In the plot below you see another example of how this works (it is not a nice plot any more).</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Solar.R</span>, y <span class="op">=</span> <span class="va">Ozone</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">Month</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Month</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/inheritance-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="attention">
<p>Any aesthetics defined outside the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function calls are <em>static</em> properties and will be dealt with in a literal manner.</p>
</div>
<p>Note that you can “override” global (<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>) aesthetics in <code>geom_xxx()</code> but this can give unexpected behavior, as seen in the paragraph on Color.</p>
</div>
</div>
<div id="aesthetics" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Aesthetics<a class="anchor" aria-label="anchor" href="#aesthetics"><i class="fas fa-link"></i></a>
</h2>
<p>After you obtain a tidy dataset and pass it to ggplot you must decide what the aesthetics are: the way the data are represented in your plot. Very roughly speaking, you could correlate the aesthetics to the <strong><em>dimensions</em></strong> of the data you want to visualize. For instance, given this chapters’ first example of the airquality dataset, the aesthetics were defined in three “dimensions”:<br>
- dimension “X” for temperature,
- dimension “Y” for Ozone
- dimension “color” for the month.</p>
<p>Although color is used most often to represent an extra dimension in the data, other aesthetics you may consider are shape, size, line width, line type and facetting (making a grid of plots).</p>
<div id="colors" class="section level3 unnumbered">
<h3>Colors<a class="anchor" aria-label="anchor" href="#colors"><i class="fas fa-link"></i></a>
</h3>
<p>Colors can be defined in a variety of ways in ggpplot (and R in general):</p>
<ul>
<li>color name</li>
<li>existing color palette</li>
<li>custom color palette</li>
</ul>
<p>Below is a panel displaying all named colors you can use in R</p>
<div class="inline-figure"><img src="DAVuR_files/figure-html/color-names-1.png" width="100%"></div>
<p>When you provide a literal (character) for the color aesthetic it will simply be that color. If you want to map a property (e.g. “Month”) to a range of colors, you should use a color palette. Since ggplot has build-in color palettes, you can simply use <code>color=&lt;my-third-dimension-variable&gt;</code>. This variable mapping to color can be either a factor (discrete scale) or numeric (continuous scale).
The ggplot function will map the variable the default color palette.</p>
<p>Be aware that there is a big difference in where you specify an aesthetic. When it should be mapped onto a variable (the values within a column) you should put it within the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> call. When you want to specify a literal -static- aesthetic (e.g. color) you place it outside the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> call. When you misplace the mapping you get strange behavior:</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Green'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/color-scope-1-1.png" width="60%" style="display: block; margin: auto;"></div>
<p>This will not work either (not evaluated because it gives an error):</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span></span></code></pre></div>
<p>And when you specify it twice the most ‘specific’ will take precedence (but the legend label is incorrect here):</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ozone</span>, y <span class="op">=</span> <span class="va">Solar.R</span>, color <span class="op">=</span> <span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Day</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/color-scope-3-1.png" width="60%" style="display: block; margin: auto;"></div>
<p>Have a look at the paragraph “Inheritance of aesthetics” for more detail.
Here are some ways to work with color palettes</p>
<div id="the-default-palette" class="section level4 unnumbered">
<h4>The default palette<a class="anchor" aria-label="anchor" href="#the-default-palette"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#store it in variable "sp" for re-use in subsequenct chunks</span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sp</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/color-palette-default-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="manual-palettes" class="section level4 unnumbered">
<h4>Manual palettes<a class="anchor" aria-label="anchor" href="#manual-palettes"><i class="fas fa-link"></i></a>
</h4>
<p>You can specify your own colors using <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual()</a></code> for scatter plots or <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual()</a></code> for boxplots and bar plots.</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"#FC4E07"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/color-palette-manual-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Here the palette is defined using the <strong><em>hexadecimal</em></strong> notation: Each color can be specified as a mix of Red, Green, and Blue values in a range from 0 to 255. In Hexadecimal notation these are the position 1 and 2 (Red), 3 and 4 (Green) and 5 and 6 (Blue) after the hash sign (#). <code>00</code> equals zero and <code>FF</code> equals 255 (16*16). This is quite a universal encoding: a gazillion websites style their pages using this notation.</p>
<p>Here is a nice set of colors:</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFDB6D"</span>, <span class="st">"#C4961A"</span>, <span class="st">"#F4EDCA"</span>, </span>
<span>                <span class="st">"#D16103"</span>, <span class="st">"#C3D7A4"</span>, <span class="st">"#52854C"</span>, <span class="st">"#4E84C4"</span>, <span class="st">"#293352"</span><span class="op">)</span></span>
<span><span class="fu">show_palette</span><span class="op">(</span><span class="va">custom_col</span>, cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">custom_col</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/custom-palette1-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Here is a colorblind-friendly palette:</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The palette with grey:</span></span>
<span><span class="va">cbp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>,</span>
<span>          <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_palette</span><span class="op">(</span><span class="va">cbp1</span>, cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cbp1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/custom-palette2-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>When you pass a palette that is longer than the number of levels in your factor, R will only use as many as required:</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">cbp1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/color-palette-manual2-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="shapes" class="section level3 unnumbered">
<h3>Shapes<a class="anchor" aria-label="anchor" href="#shapes"><i class="fas fa-link"></i></a>
</h3>
<p>These are the shapes available in ggplot2 (and base R as well).</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">19</span>, <span class="fl">22</span>, <span class="fl">21</span>, <span class="fl">24</span>, <span class="fl">23</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">24</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">5</span>,</span>
<span>  y <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">24</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">shapes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">shape</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">shape</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_x <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html">scale_shape_identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#expand_limits(x = 4.1) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/shapes-overview-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Warning: do not clutter your plot with too many dimensions/aesthetics!</p>
</div>
<div id="lines" class="section level3 unnumbered">
<h3>Lines<a class="anchor" aria-label="anchor" href="#lines"><i class="fas fa-link"></i></a>
</h3>
<p>Geoms that draw lines have a “linetype” parameter.</p>
<p>Legal values are the strings “blank”, “solid”, “dashed”, “dotted”, “dotdash”, “longdash”, and “twodash”. Alternatively, the numbers 0 to 6 can be used (0 for “blank”, 1 for “solid”, …).</p>
<p>You can set line type to a constant value. For this you use the linetype geom parameter. For instance, <code>geom_line(data=d, mapping=aes(x=x, y=y), linetype=3)</code> sets the line type of all lines in that layer to 3, which corresponds to a dotted line), but you can also use it dynamically.</p>
<p>Here is an example where the female and male deaths in the UK for 72 successive months are plotted. The <code>linetype = sex</code> aesthetic could as well have been defined within the global <code>ggplot</code> call. It may be a bit more logical to specify it where it applies to the geom.</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">72</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">72</span><span class="op">)</span>,</span>
<span>    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mdeaths</span>, <span class="va">fdeaths</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">deaths</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span>, y <span class="op">=</span> <span class="va">deaths</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="DAVuR_files/figure-html/linecolor-dim-1.png" width="80%" style="display: block; margin: auto;">
When you want to add lines of same type, color and width, you can use the <code>group=</code> argument in <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code>. In the next example, all the chickens on the same diet get the same colour:</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ChickWeight</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">weight</span>, color <span class="op">=</span> <span class="va">Diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">Chick</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/geom-line-group-example-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="size" class="section level3 unnumbered">
<h3>Size<a class="anchor" aria-label="anchor" href="#size"><i class="fas fa-link"></i></a>
</h3>
<p>The size of the plotting symbol can also be used as an extra dimension in your visualization. Here is an example showing the solar radiation of the airquality data as third dimension.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Wind</span>, y <span class="op">=</span> <span class="va">Ozone</span>, size <span class="op">=</span> <span class="va">Solar.R</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"Solar radiation (Lang)"</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/sizes-demo-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="geometries" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Geometries<a class="anchor" aria-label="anchor" href="#geometries"><i class="fas fa-link"></i></a>
</h2>
<div id="what-are-geometries" class="section level3 unnumbered">
<h3>What are geometries<a class="anchor" aria-label="anchor" href="#what-are-geometries"><i class="fas fa-link"></i></a>
</h3>
<p>Geometries are the ways data can be visually represented. Boxplot, scatterplot and histogram are a few examples. There are <strong><em>many</em></strong> geoms available in ggplot2; type <code>geom_</code> in the console and you will get a listing. Even more are available outside the ggplot2 package. Here we’ll only explore the most used geoms in science.</p>
</div>
<div id="boxplot" class="section level3 unnumbered">
<h3>Boxplot<a class="anchor" aria-label="anchor" href="#boxplot"><i class="fas fa-link"></i></a>
</h3>
<p>Boxplot is one of the most-used data visualizations. It displays the 5-number summary containing from bottom to top: minimum, first quartile, median (= second quartile), third quartile, maximum. Outliers, usually defined as more than <code>1.5 * IQR</code> from the median, are displayed as separate points. Some color was added in the example below.</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dr_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dose_response_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dose</span>, y <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dr_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'#E69F00'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/plot_geom_boxplot-1.png" width="576"></div>
</div>
<div id="jitter" class="section level3 unnumbered">
<h3>Jitter<a class="anchor" aria-label="anchor" href="#jitter"><i class="fas fa-link"></i></a>
</h3>
<p>Jitter is a good alternative to boxplot when you have small sample sizes, or discrete measurements with many exact copies, resulting in much overlap. Use the width and height attributes to adjust the jittering.</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dr_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/plot_geom_jitter-1.png" width="576"></div>
<p>Note that vertical jitter was set to zero because the y-axis values are already in a continuous scale. You should use vertical jittering only when these have discreet values that otherwise overlap too much.</p>
<p>Below, a split over the sexes is added. Suddenly, a dramatic dosage effect becomes apparent that was smoothed out when the two sexes were combined.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dr_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="fl">0</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/plot_tidy_color-1.png" width="672"></div>
<p>Alternatively, use a grid of plots to emphasize the contrast further.</p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dr_plot</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="fl">0</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="va">.</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/plot_tidy_facet-1.png" width="672"></div>
</div>
<div id="plot-overlays-boxplot-jitter" class="section level3 unnumbered">
<h3>Plot overlays: boxplot + jitter<a class="anchor" aria-label="anchor" href="#plot-overlays-boxplot-jitter"><i class="fas fa-link"></i></a>
</h3>
<p>This example shows how you can overlay plots on top of each other as much as you like. The order in which you define the layers is the order in which they are stacked on top of each other in the graph. You could use this as a feature:</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## 
## Attaching package: 'gridExtra'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     combine</code></pre>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dr_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dose_response_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dose</span>, y <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">dr_plot</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'#E69F00'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">dr_plot</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'#E69F00'</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#create a panel of plots</span></span></code></pre></div>
<p><img src="DAVuR_files/figure-html/plot-overlays-1.png" width="80%" style="display: block; margin: auto;">
The <code>gridExtra</code> package is discussed in a more complex setting below, in section “Advanced plotting aspects”.</p>
</div>
<div id="plot-overlays-smooth-ribbon" class="section level3 unnumbered">
<h3>Plot overlays: smooth + ribbon<a class="anchor" aria-label="anchor" href="#plot-overlays-smooth-ribbon"><i class="fas fa-link"></i></a>
</h3>
<p>Here is another pair of examples of overlays of different geoms. In the first, the original datapoints are included.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">displ</span>, <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"darkgreen"</span>, method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                    ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">hwy</span> <span class="op">~</span> <span class="va">displ</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                alpha <span class="op">=</span> <span class="fl">0.3</span>, fill <span class="op">=</span> <span class="st">'green'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/plot-overlays-2-1.png" width="672"></div>
<p>Note that the <code>method = "loess", formula = "y ~ x"</code> arguments to <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> are the defaults. However, if omitted they trigger a message (<code>\</code>geom_smooth()` using method = ‘loess’ and formula ‘y ~ x’`) that I do not like in my output.
In this second example, the data points are omitted altogether, making the plot focus solely on global trend.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">displ</span>, <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                    ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">hwy</span> <span class="op">~</span> <span class="va">displ</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                alpha <span class="op">=</span> <span class="fl">0.3</span>, fill <span class="op">=</span> <span class="st">'green'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">$</span><span class="va">hwy</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="DAVuR_files/figure-html/plot-overlays-3-1.png" width="672"></div>
</div>
<div id="scatterplot-points" class="section level3 unnumbered">
<h3>Scatterplot: Points<a class="anchor" aria-label="anchor" href="#scatterplot-points"><i class="fas fa-link"></i></a>
</h3>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> function is used to create the good old scatterplot of which we have seen several examples already.</p>
</div>
<div id="line-plots" class="section level3 unnumbered">
<h3>Line plots<a class="anchor" aria-label="anchor" href="#line-plots"><i class="fas fa-link"></i></a>
</h3>
<p>When points can be logically connected it may be a good idea to use a line to visualize trends, as we have seen in the <code>deaths</code> plot in section Aesthetics.</p>
<p>If you want both lines and points you need to overlay them. In this example I take it a bit further bu adding the dimension ‘activity’ to the points geom only. This is a typical case for geom_line since the measurements of the two beavers were taken sequentially, for that particular beaver.</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b1_start</span> <span class="op">&lt;-</span> <span class="va">beaver1</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"time"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">60</span></span>
<span><span class="va">b2_start</span> <span class="op">&lt;-</span> <span class="va">beaver1</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"time"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">60</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#uses dplyr (later this course)</span></span>
<span><span class="va">beaverA</span> <span class="op">&lt;-</span> <span class="va">beaver1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">b1_start</span>, </span>
<span>                                           to <span class="op">=</span> <span class="va">b1_start</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">beaver1</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">/</span><span class="fl">60</span>, </span>
<span>                                           length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">beaver1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beaverB</span> <span class="op">&lt;-</span> <span class="va">beaver2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">b2_start</span>, </span>
<span>                                           to <span class="op">=</span> <span class="va">b2_start</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">beaver2</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">/</span><span class="fl">60</span>, </span>
<span>                                           length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">beaver2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beavers_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">beaverA</span>, <span class="va">beaverB</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>beaver <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">beaverA</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">beaverB</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           activity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">activ</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inactive"</span>, <span class="st">"active"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">beavers_all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_h</span>, y <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">beaver</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">activity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"time (h)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">'Temperature ('</span><span class="op">*</span><span class="op">~</span><span class="va">degree</span><span class="op">*</span><span class="va">C</span><span class="op">*</span><span class="st">')'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/overlay-points-lines-beavers-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="histograms-1" class="section level3 unnumbered">
<h3>Histograms<a class="anchor" aria-label="anchor" href="#histograms-1"><i class="fas fa-link"></i></a>
</h3>
<p>A histogram is a means to visualize the distribution of a dataset, as are boxplot (<code><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot()</a></code>), violin plot (<code><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin()</a></code>) and density plot (<code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly()</a></code>).</p>
<p>Here we look at the eruption intervals of the “faithful” geyser. A <code>binwidth</code> argument is used to adjust the number of bins. Alternative use the <code>bins</code> argument.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">faithful</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">waiting</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/histogram1-1.png" width="60%" style="display: block; margin: auto;"></div>
<p>There are some statistics available to adjust what is shown on the y axis. The default that is used by <code>geom_histogram</code> is <code>stat(count)</code>, so if you don’t specify anything this will be used. But if you want it scaled to a maximum of 1, use <code>stat(count / max(count))</code>. The <code><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat()</a></code> function is a flag to ggplot2 that you want to use calculated aesthetics produced by the statistic.You can use any transformation of the statistic, e.g. <code>y = stat(log2(count))</code>.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">faithful</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">waiting</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"normalized proportion"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: `stat(count / max(count))` was deprecated in ggplot2 3.4.0.
## ℹ Please use `after_stat(count / max(count))` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="inline-figure"><img src="DAVuR_files/figure-html/histogram2-1.png" width="60%" style="display: block; margin: auto;"></div>
<p>Alternatively, if you want percentages, you can use <code>y = stat(count / sum(count) * 100)</code>.</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">faithful</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">waiting</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">3</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/histogram3-1.png" width="60%" style="display: block; margin: auto;"></div>
</div>
<div id="violin-plot" class="section level3 unnumbered">
<h3>Violin plot<a class="anchor" aria-label="anchor" href="#violin-plot"><i class="fas fa-link"></i></a>
</h3>
<p>A violin plot is a compact display of a continuous distribution. It is a blend of geom_boxplot() and geom_density(): a violin plot is a mirrored density plot displayed in the same way as a boxplot. It is not seen as often as should be. An example best explains.</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">airqual</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Month</span>, y <span class="op">=</span> <span class="va">Temp</span>, fill <span class="op">=</span> <span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/violinplot-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="barplot" class="section level3 unnumbered">
<h3>Barplot<a class="anchor" aria-label="anchor" href="#barplot"><i class="fas fa-link"></i></a>
</h3>
<p>The bar plot is similar to a histogram in appearance, but quite different in intent. Where a histogram visualizes the density of a continuous variable, a bar plot tries to visualize the counts (or weights) of distinct groups.</p>
<p>If you don’t provide a <code>weight</code> aesthetic, geom_bar will count all occurrences of the different values in the provided x-axis variable. Here is an example.</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">esoph</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alcgp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/barplot1-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>You can provide a <code>weight</code> argument In that case the counts will be replaced by the literal value found in that variable.
Here is a small example where the ten subjects of the <code>sleep</code> dataset have been charted (the x axis), and the <code>extra</code> column provided the height of the bar, split over the two groups. I used the <code>position</code> argument to get side-by-side bars instead of stacked on top of each other.</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sleep</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">extra</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, </span>
<span>             position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.6</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"student ID"</span>, y <span class="op">=</span> <span class="st">"increase in sleep (h)"</span>, fill <span class="op">=</span> <span class="st">"Drug"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="DAVuR_files/figure-html/barplot2-1.png" width="80%" style="display: block; margin: auto;">
The <code>position =</code> argument could have been <code>"dodge"</code> for simple side-by-side plotting of the bars.</p>
</div>
<div id="overview-of-the-main-geoms" class="section level3 unnumbered">
<h3>Overview of the main geoms<a class="anchor" aria-label="anchor" href="#overview-of-the-main-geoms"><i class="fas fa-link"></i></a>
</h3>
<p>There are many geoms and even more outside the ggplot2 package.
Here is a small overview of some of them.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:ggplot2-building-blocks-2">Table 5.2: </span>Some more geoms</caption>
<colgroup>
<col width="11%">
<col width="88%">
</colgroup>
<thead><tr class="header">
<th align="left">function.</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">geom_abline()</td>
<td align="left">Add reference lines to a plot, either horizontal, vertical, or diagonal</td>
</tr>
<tr class="even">
<td align="left">geom_bar()</td>
<td align="left">A bar plot makes the height of the bar proportional to the number of cases in each group</td>
</tr>
<tr class="odd">
<td align="left">geom_density()</td>
<td align="left">Computes and draws kernel density estimate, which is a smoothed version of the histogram</td>
</tr>
<tr class="even">
<td align="left">geom_line()</td>
<td align="left">Connects the observations in order of the variable on the x axis</td>
</tr>
<tr class="odd">
<td align="left">geom_path()</td>
<td align="left">Connects the observations in the order in which they appear in the data</td>
</tr>
<tr class="even">
<td align="left">geom_qq()</td>
<td align="left">geom_qq and stat_qq produce quantile-quantile plots</td>
</tr>
<tr class="odd">
<td align="left">geom_smooth()</td>
<td align="left">Aids the eye in seeing patterns in the presence of overplotting</td>
</tr>
<tr class="even">
<td align="left">geom_violin()</td>
<td align="left">A violin plot is a compact display of a continuous distribution. It is a blend of geom_boxplot() and geom_density()</td>
</tr>
</tbody>
</table></div>
<p>If you want to know them all, simply type <code>?geom_</code> and select the one that looks like the thing you want, or go to the tidyverse <a href="https://ggplot2.tidyverse.org/reference/">ggplot2 reference page</a>.</p>
</div>
</div>
<div id="faceting" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Faceting<a class="anchor" aria-label="anchor" href="#faceting"><i class="fas fa-link"></i></a>
</h2>
<p>Faceting is the process of splitting into multiple plots with exactly the same coordinate system where each plot show a subset of the data. It can be applied to any geom. The figure above could be improved slightly with this technique.</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airqual</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Solar.R</span>, y <span class="op">=</span> <span class="va">Ozone</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">Month</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Month</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Month</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/facetting-1.png" width="80%" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="complex-datatypes-and-file-reading.html"><span class="header-section-number">4</span> Complex Datatypes and File Reading</a></div>
<div class="next"><a href="built-in-functions.html"><span class="header-section-number">6</span> Built-in Functions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot2"><span class="header-section-number">5</span> Basics of the ggplot2 package</a></li>
<li>
<a class="nav-link" href="#getting-started-1"><span class="header-section-number">5.1</span> Getting started</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#keep-the-goal-in-mind">Keep the goal in mind</a></li>
<li><a class="nav-link" href="#a-first-plot">A first plot</a></li>
<li><a class="nav-link" href="#adding-a-dimension-using-color">Adding a dimension using color</a></li>
<li><a class="nav-link" href="#inspecting-and-tuning-the-figure">Inspecting and tuning the figure</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#overview-of-ggplot"><span class="header-section-number">5.2</span> Overview of ggplot</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot2-and-the-theory-of-graphics"><span class="header-section-number">5.2.1</span> ggplot2 and the theory of graphics</a></li>
<li><a class="nav-link" href="#building-plots-with-ggplot2"><span class="header-section-number">5.2.2</span> Building plots with ggplot2</a></li>
<li><a class="nav-link" href="#inheritance-of-aesthetics"><span class="header-section-number">5.2.3</span> Inheritance of aesthetics</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#aesthetics"><span class="header-section-number">5.3</span> Aesthetics</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#colors">Colors</a></li>
<li><a class="nav-link" href="#shapes">Shapes</a></li>
<li><a class="nav-link" href="#lines">Lines</a></li>
<li><a class="nav-link" href="#size">Size</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#geometries"><span class="header-section-number">5.4</span> Geometries</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-are-geometries">What are geometries</a></li>
<li><a class="nav-link" href="#boxplot">Boxplot</a></li>
<li><a class="nav-link" href="#jitter">Jitter</a></li>
<li><a class="nav-link" href="#plot-overlays-boxplot-jitter">Plot overlays: boxplot + jitter</a></li>
<li><a class="nav-link" href="#plot-overlays-smooth-ribbon">Plot overlays: smooth + ribbon</a></li>
<li><a class="nav-link" href="#scatterplot-points">Scatterplot: Points</a></li>
<li><a class="nav-link" href="#line-plots">Line plots</a></li>
<li><a class="nav-link" href="#histograms-1">Histograms</a></li>
<li><a class="nav-link" href="#violin-plot">Violin plot</a></li>
<li><a class="nav-link" href="#barplot">Barplot</a></li>
<li><a class="nav-link" href="#overview-of-the-main-geoms">Overview of the main geoms</a></li>
</ul>
</li>
<li><a class="nav-link" href="#faceting"><span class="header-section-number">5.5</span> Faceting</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Analysis and Visualization using R</strong>" was written by Michiel Noback. It was last built on 2024-03-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
