<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 13 Working with date-time data | Data Analysis and Visualization using R</title>
<meta name="author" content="Michiel Noback">
<meta name="description" content="13.1 The lubridate package  13.1.1 Parsing character data When working in a lab you will often encounter time-measured data. For instance, growth curves, animal behavior observations etc. The...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Chapter 13 Working with date-time data | Data Analysis and Visualization using R">
<meta property="og:type" content="book">
<meta property="og:description" content="13.1 The lubridate package  13.1.1 Parsing character data When working in a lab you will often encounter time-measured data. For instance, growth curves, animal behavior observations etc. The...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 13 Working with date-time data | Data Analysis and Visualization using R">
<meta name="twitter:description" content="13.1 The lubridate package  13.1.1 Parsing character data When working in a lab you will often encounter time-measured data. For instance, growth curves, animal behavior observations etc. The...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.27/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Analysis and Visualization using R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Getting started</a></li>
<li><a class="" href="toolbox.html"><span class="header-section-number">2</span> The toolbox</a></li>
<li><a class="" href="basic-r.html"><span class="header-section-number">3</span> Basic R</a></li>
<li><a class="" href="complex-datatypes-and-file-reading.html"><span class="header-section-number">4</span> Complex Datatypes and File Reading</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">5</span> Basics of the ggplot2 package</a></li>
<li><a class="" href="built-in-functions.html"><span class="header-section-number">6</span> Built-in Functions</a></li>
<li><a class="" href="flow-control-and-scripting.html"><span class="header-section-number">7</span> Flow control and scripting</a></li>
<li><a class="" href="tidyr.html"><span class="header-section-number">8</span> Tidying dataframes using Package tidyr</a></li>
<li><a class="" href="mangling.html"><span class="header-section-number">9</span> Old school data mangling</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">10</span> Data mangling with dplyr</a></li>
<li><a class="" href="regex.html"><span class="header-section-number">11</span> Text processing with regex</a></li>
<li><a class="" href="ggplot2-adv.html"><span class="header-section-number">12</span> Package ggplot2 revisited</a></li>
<li><a class="active" href="date-time.html"><span class="header-section-number">13</span> Working with date-time data</a></li>
<li><a class="" href="eda-1.html"><span class="header-section-number">14</span> Exploratory Data Analysis I</a></li>
<li><a class="" href="eda-2.html"><span class="header-section-number">15</span> Exploratory Data Analysis II</a></li>
<li><a class="" href="exercises.html"><span class="header-section-number">16</span> Exercises</a></li>
<li><a class="" href="exercise-solutions.html"><span class="header-section-number">17</span> Exercise solutions</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="date-time" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Working with date-time data<a class="anchor" aria-label="anchor" href="#date-time"><i class="fas fa-link"></i></a>
</h1>
<div id="the-lubridate-package" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> The <code>lubridate</code> package<a class="anchor" aria-label="anchor" href="#the-lubridate-package"><i class="fas fa-link"></i></a>
</h2>
<div id="parsing-character-data" class="section level3" number="13.1.1">
<h3>
<span class="header-section-number">13.1.1</span> Parsing character data<a class="anchor" aria-label="anchor" href="#parsing-character-data"><i class="fas fa-link"></i></a>
</h3>
<p>When working in a lab you will often encounter time-measured data. For instance, growth curves, animal behavior observations etc.</p>
<p>The tidyverse package <code>lubridate</code> can help you with that. It is quite an expensive package; only the bare essentials will be dealt with here. For a bit more complete overview have a look at the <a href="graphics/lubridate.pdf">cheat sheet</a>.</p>
<p>A small fictitious dataset will be used here to explore some of the concepts. It can be found in file <code>data/time_series_drug_test.txt</code>.</p>
<div class="sourceCode" id="cb760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/time_series_drug_test.txt"</span>, </span>
<span>                 header <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                 sep <span class="op">=</span> <span class="st">";"</span>,</span>
<span>                 as.is <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></span>
<span><span class="va">ts</span></span></code></pre></div>
<pre><code>## # A tibble: 48 × 5
##   subject date       time  control response
##   &lt;fct&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;fct&gt;      &lt;int&gt;
## 1 S001    29/12/2019 07:44 n              2
## 2 S001    29/12/2019 12:06 n             68
## 3 S001    29/12/2019 17:28 n            112
## 4 S001    29/12/2019 22:01 n             82
## 5 S001    30/12/2019 07:22 n             63
## 6 S001    30/12/2019 12:05 n             57
## # ℹ 42 more rows</code></pre>
<p>If you simply want to show the timeseries as a plot, the date and time columns need to be combined first. The tidyr package has <code>unite()</code>, or do it with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code></p>
<div class="sourceCode" id="cb762"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="st">"date_time"</span>, <span class="va">date</span>, <span class="va">time</span>, sep <span class="op">=</span> <span class="st">"T"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   subject date_time        control response
##   &lt;fct&gt;   &lt;chr&gt;            &lt;fct&gt;      &lt;int&gt;
## 1 S001    29/12/2019T07:44 n              2
## 2 S001    29/12/2019T12:06 n             68
## 3 S001    29/12/2019T17:28 n            112</code></pre>
<p>As you can see, the original data columns are lost in this operation. Using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> does keep them intact however. I will take this approach because I want the old columns for demonstration purposes.</p>
<div class="sourceCode" id="cb764"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">time</span>, sep<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ts</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   subject date       time  control response date_time       
##   &lt;fct&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;fct&gt;      &lt;int&gt; &lt;chr&gt;           
## 1 S001    29/12/2019 07:44 n              2 29/12/2019 07:44
## 2 S001    29/12/2019 12:06 n             68 29/12/2019 12:06
## 3 S001    29/12/2019 17:28 n            112 29/12/2019 17:28</code></pre>
<p>Let’s reshuffle. I like it when my dependent variable comes last.</p>
<div class="sourceCode" id="cb766"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">date</span>, <span class="va">time</span>, <span class="va">date_time</span>, <span class="va">control</span>, <span class="va">response</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ts</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   subject date       time  date_time        control response
##   &lt;fct&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;            &lt;fct&gt;      &lt;int&gt;
## 1 S001    29/12/2019 07:44 29/12/2019 07:44 n              2
## 2 S001    29/12/2019 12:06 29/12/2019 12:06 n             68
## 3 S001    29/12/2019 17:28 29/12/2019 17:28 n            112</code></pre>
<p>If I attempt to plot the response over time for each of the subjects I get into trouble:</p>
<div class="sourceCode" id="cb768"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ts</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">response</span>, linetype <span class="op">=</span> <span class="va">subject</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/lubridate-ggplot-1.png" width="672"></div>
<p>Also, when I would like to calculate something like the change per hour in response level over the different measurements this would be difficult indeed. Take a minute to think about this. Do you know any technique in base R that you’ve encountered so far that supports this?<br>
Actually there are some functions in baser R that can do this, but we’ll stick to the tidyverse.</p>
<p>So this is the area of the <code>lubridate</code> package. I included a <code><a href="https://lubridate.tidyverse.org">library(lubridate)</a></code> statement at the top of this document so that’s not needed anymore.</p>
<p>Let’s start with reading in date and time variables. There are many dedicated (wrapper) functions for reading date and time data. The <code>date</code> variable has the format “<strong>D</strong>ay/<strong>M</strong>onth/<strong>Y</strong>ear” so the function <code>dmy()</code> should be fine here:</p>
<div class="sourceCode" id="cb769"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu">dmy</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   subject date       time  date_time        control response
##   &lt;fct&gt;   &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;            &lt;fct&gt;      &lt;int&gt;
## 1 S001    2019-12-29 07:44 29/12/2019 07:44 n              2
## 2 S001    2019-12-29 12:06 29/12/2019 12:06 n             68
## 3 S001    2019-12-29 17:28 29/12/2019 17:28 n            112</code></pre>
<p>As you can see, the type has changed into <code>date</code>. Let’s try the plot again:</p>
<div class="sourceCode" id="cb771"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ts</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">response</span>, linetype <span class="op">=</span> <span class="va">subject</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/lubridate-mutate-3-1.png" width="672"></div>
<p>Now we’re getting somewhere. The times are not taken into account yet, so it is simply mapped to 00:00 hours on that day. Also, we’re not really interested in the specific date, we want to know the change from T = 0. We’ll get to that.</p>
<p>Parsing time is the same as parsing the date, we have an “<strong>H</strong>our:<strong>M</strong>inute” format so the function to take is <code>hm()</code> (there is also an <code>hms()</code>):</p>
<div class="sourceCode" id="cb772"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hm</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] "7H 44M 0S"  "12H 6M 0S"  "17H 28M 0S" "22H 1M 0S"  "7H 22M 0S"</code></pre>
<p>And yes, there is also an <code>dmy_hm()</code> function:</p>
<div class="sourceCode" id="cb774"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dmy_hm</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] "2019-12-29 07:44:00 UTC" "2019-12-29 12:06:00 UTC"
## [3] "2019-12-29 17:28:00 UTC" "2019-12-29 22:01:00 UTC"
## [5] "2019-12-30 07:22:00 UTC"</code></pre>
<p>As long as the format is not too esoteric, lubridate will figure out the separator quite well.</p>
<p>If you want full control -or simply want to remember only one or two functions- you could take either one of <code>fast_strptime()</code> or <code>parse_date_time()</code>. Both take a <strong><em>format string</em></strong> as argument: a string in which you specify the way your date-time character data are structured The most used symbols are these (although you should really also look at the help page):</p>
<ul>
<li>
<strong><code>b</code></strong> or <strong><code>B</code></strong> Abbreviated or full month name in the current locale. The C parser currently understands only English month names.</li>
<li>
<strong><code>d</code></strong> Day of the month as decimal number (01–31 or 0–31)</li>
<li>
<strong><code>H</code></strong> Hours as decimal number (00–24 or 0–24).</li>
<li>
<strong><code>I</code></strong> Hours as decimal number (01–12 or 1–12).</li>
<li>
<strong><code>m</code></strong> Month as decimal number (01–12 or 1–12).</li>
<li>
<strong><code>M</code></strong> Minute as decimal number (00–59 or 0–59).</li>
<li>
<strong><code>p</code></strong> AM/PM indicator in the locale. Normally used in conjunction with I and not with H.</li>
<li>
<strong><code>S</code></strong> Second as decimal number (00–61 or 0–61).</li>
<li>
<strong><code>y</code></strong> Year without century (00–99 or 0–99). In parse_date_time() also matches year with century (Y format).</li>
<li>
<strong><code>Y</code></strong> Year with century.</li>
</ul>
<p>Function <code>parse_date_time()</code> is the most lenient of the two with respect to the <strong><em>format string</em></strong>:</p>
<div class="sourceCode" id="cb776"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">parse_date_time</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">date_time</span>, <span class="st">"d.m-y H:M"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="co">##doesn't care I have a typo in my format string</span></span></code></pre></div>
<pre><code>## [1] "2019-12-29 07:44:00 UTC" "2019-12-29 12:06:00 UTC"
## [3] "2019-12-29 17:28:00 UTC" "2019-12-29 22:01:00 UTC"
## [5] "2019-12-30 07:22:00 UTC"</code></pre>
<div class="sourceCode" id="cb778"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_time <span class="op">=</span> <span class="fu">parse_date_time</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">date_time</span>, <span class="st">"d/m/y H:M"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ts</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   subject date       time  date_time           control response
##   &lt;fct&gt;   &lt;date&gt;     &lt;chr&gt; &lt;dttm&gt;              &lt;fct&gt;      &lt;int&gt;
## 1 S001    2019-12-29 07:44 2019-12-29 07:44:00 n              2
## 2 S001    2019-12-29 12:06 2019-12-29 12:06:00 n             68
## 3 S001    2019-12-29 17:28 2019-12-29 17:28:00 n            112</code></pre>
<p>The <code>fast_strptime()</code> is much more picky, but much faster. You specify the date(-time) format using<code>%</code> sign together with one of the symbols listed above:</p>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fast_strptime</span><span class="op">(</span><span class="st">'29/12/2019 07:44'</span>, <span class="st">'%d/%m/%Y %H:%M'</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "2019-12-29 07:44:00 UTC"</code></pre>
<div class="sourceCode" id="cb782"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## When in tibble context, you need to set `lt = F`...</span></span>
<span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_time <span class="op">=</span> <span class="fu">fast_strptime</span><span class="op">(</span><span class="va">date_time</span>, <span class="st">'%d/%m/%Y %H:%M'</span>, lt <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>I think sticking to the first will suffice.</p>
</div>
<div id="current-time" class="section level3" number="13.1.2">
<h3>
<span class="header-section-number">13.1.2</span> Current time<a class="anchor" aria-label="anchor" href="#current-time"><i class="fas fa-link"></i></a>
</h3>
<p>The functions <code>today()</code> and <code>now()</code> are your friends.</p>
<div class="sourceCode" id="cb783"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##output will vary!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"the day is "</span>, <span class="fu">today</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "the day is  2023-06-26"</code></pre>
<div class="sourceCode" id="cb785"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"and to be really exact: "</span>, <span class="fu">now</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "and to be really exact:  2023-06-26 15:39:11"</code></pre>
</div>
<div id="getting-elements-from-date-time-objects" class="section level3" number="13.1.3">
<h3>
<span class="header-section-number">13.1.3</span> Getting elements from date-time objects<a class="anchor" aria-label="anchor" href="#getting-elements-from-date-time-objects"><i class="fas fa-link"></i></a>
</h3>
<p>Once you have the date-time object processed, you can look at the individual elements.</p>
<p>There are -again- many functions related to this. Have a look at the <a href="graphics/lubridate.pdf">cheat sheet</a> for details. Here are the most-used components:</p>
<ul>
<li>
<strong><code>date(x)</code></strong> Date component leaving the time out.</li>
<li>
<strong><code>year(x)</code></strong> The year.</li>
<li>
<strong><code>month(x, label, abbr)</code></strong> The month. When called without other argument, you get the month number (e.g. 2). With the <code>label = TRUE</code> argument you will get text (e.g. Feb) and <code>abbr = FALSE</code> you get the full name of the month (February).</li>
<li>
<strong><code>day(x)</code></strong> The day of the month.</li>
<li>
<strong><code>wday(x,label,abbr)</code></strong> The day of week. Label and abbr behaves the same as with <code>month()</code>.</li>
<li>
<strong><code>hour(x)</code></strong> The hour</li>
<li>
<strong><code>minute(x)</code></strong> Minutes.</li>
<li>
<strong><code>second(x)</code></strong> Seconds.</li>
<li>
<strong><code>week(x)</code></strong> Week of the year.</li>
</ul>
<p>A use case demonstration: On what days were the samples taken of the times series used so far?</p>
<div class="sourceCode" id="cb787"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>day_of_week <span class="op">=</span> <span class="fu">wday</span><span class="op">(</span><span class="va">date_time</span>, label<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>sample_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># or, shorter</span></span>
<span><span class="co">#ts %&gt;% group_by(day_of_week = wday(date_time, label=T)) %&gt;% tally()</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   day_of_week sample_count
##   &lt;ord&gt;              &lt;int&gt;
## 1 Sun                   24
## 2 Mon                   24</code></pre>
<p>What was the mean response on the different times of the day:</p>
<div class="sourceCode" id="cb789"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>hour_of_day <span class="op">=</span> <span class="fu">hour</span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   hour_of_day  mean
##         &lt;int&gt; &lt;dbl&gt;
## 1           7  19.8
## 2          12  41.5
## 3          17  68.8
## 4          22  52</code></pre>
<p>And when split over the control/treatment group as well:</p>
<div class="sourceCode" id="cb791"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">control</span>, hour_of_day <span class="op">=</span> <span class="fu">hour</span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span>,</span>
<span>              n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'control'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 8 × 4
## # Groups:   control [2]
##   control hour_of_day  mean     n
##   &lt;fct&gt;         &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
## 1 n                 7  31       6
## 2 n                12  60       6
## 3 n                17  97       6
## 4 n                22  65.5     6
## 5 y                 7   6.5     6
## 6 y                12  20.5     6
## 7 y                17  42.5     6
## 8 y                22  34.5     6</code></pre>
<p>Finally, let’s close off with a plot</p>
<div class="sourceCode" id="cb794"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ts</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_time</span>, y <span class="op">=</span> <span class="va">response</span>, color <span class="op">=</span> <span class="va">subject</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="DAVuR_files/figure-html/lubridate-hour-3-1.png" width="672"></div>
<p>As practice, you could try to generate a response plot like this where subjects 1 to 3 have corrected values based on the non-treated group.</p>
</div>
<div id="calculations-with-date-time" class="section level3" number="13.1.4">
<h3>
<span class="header-section-number">13.1.4</span> Calculations with date-time<a class="anchor" aria-label="anchor" href="#calculations-with-date-time"><i class="fas fa-link"></i></a>
</h3>
<p>The example below shows the most basic calculation: the difference between two date-time objects.</p>
<div class="sourceCode" id="cb795"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">subject</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">date_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lagged <span class="op">=</span> <span class="fu">lag</span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span>, </span>
<span>           diff <span class="op">=</span> <span class="va">date_time</span> <span class="op">-</span> <span class="va">lagged</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## # A tibble: 48 × 4
## # Groups:   subject [6]
##   subject date_time           lagged              diff      
##   &lt;fct&gt;   &lt;dttm&gt;              &lt;dttm&gt;              &lt;drtn&gt;    
## 1 S001    2019-12-29 07:44:00 NA                    NA hours
## 2 S001    2019-12-29 12:06:00 2019-12-29 07:44:00 4.37 hours
## 3 S001    2019-12-29 17:28:00 2019-12-29 12:06:00 5.37 hours
## 4 S001    2019-12-29 22:01:00 2019-12-29 17:28:00 4.55 hours
## 5 S001    2019-12-30 07:22:00 2019-12-29 22:01:00 9.35 hours
## 6 S001    2019-12-30 12:05:00 2019-12-30 07:22:00 4.72 hours
## # ℹ 42 more rows</code></pre>
<p>You can define periods, durations and work with time intervals. However, this is outside the scope of this course.
For this more advanced time math you should refer to the cheat sheet or the official docs.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ggplot2-adv.html"><span class="header-section-number">12</span> Package ggplot2 revisited</a></div>
<div class="next"><a href="eda-1.html"><span class="header-section-number">14</span> Exploratory Data Analysis I</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#date-time"><span class="header-section-number">13</span> Working with date-time data</a></li>
<li>
<a class="nav-link" href="#the-lubridate-package"><span class="header-section-number">13.1</span> The lubridate package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#parsing-character-data"><span class="header-section-number">13.1.1</span> Parsing character data</a></li>
<li><a class="nav-link" href="#current-time"><span class="header-section-number">13.1.2</span> Current time</a></li>
<li><a class="nav-link" href="#getting-elements-from-date-time-objects"><span class="header-section-number">13.1.3</span> Getting elements from date-time objects</a></li>
<li><a class="nav-link" href="#calculations-with-date-time"><span class="header-section-number">13.1.4</span> Calculations with date-time</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Analysis and Visualization using R</strong>" was written by Michiel Noback. It was last built on 2023-06-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
